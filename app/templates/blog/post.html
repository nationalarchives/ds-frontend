{% extends 'base.html' %}

{%- from 'components/breadcrumbs/macro.html' import tnaBreadcrumbs -%}
{%- from 'components/hero/macro.html' import tnaHero -%}
{%- from 'macros/global_alert_banners.html' import global_alert_banners -%}
{%- from 'macros/authors_list.html' import authors_list -%}
{%- from 'macros/meta.html' import meta -%}
{%- from 'macros/wagtail_blocks/featured_page.html' import wagtailFeaturedPage -%}
{%- from 'macros/wagtail_body.html' import wagtail_body -%}

{%- set themeAccent = 'black' if page_data.mourning_notice else 'orange' -%}
{%- set pageTitle = page_data.title -%}

{%- set bodyContainsMedia = page_data.body | wagtail_streamfield_contains_media -%}

{% block head %}
{{ super() }}
{{ meta(page_data) }}
{% endblock %}

{% block stylesheets %}
{{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='blog.css', v=app_config.BUILD_VERSION) }}" media="screen,print">
    {%- if bodyContainsMedia %}
    <link rel="stylesheet" href="{{ url_for('static', filename='media.css', v=app_config.BUILD_VERSION) }}" media="screen,print">
    {%- endif %}
{% endblock %}

{% block main %}
  {% block beforeContent %}
  {%- if breadcrumbs and breadcrumbs | length > 0 %}
    <div class="tna-background-accent-light">
      <div class="tna-container">
        <div class="tna-column tna-column--full tna-!--padding-vertical-s">
          {{ tnaBreadcrumbs({
            'items': breadcrumbs,
            'structuredData': True
          }) }}
        </div>
      </div>
    </div>
  {%- endif %}
  {% endblock %}
  <main class="tna-main {{ mainClasses }}" id="main-content">
    {%- if page_data.global_alert or page_data.mourning_notice %}
    <div class="tna-background-accent-light">
      {{ global_alert_banners(page_data.global_alert, page_data.mourning_notice) }}
    </div>
    {%- endif %}
    <article class="etna-article" itemscope itemtype="https://schema.org/Article">
      <meta itemprop="datePublished" content="{{ page_data.published_date.value }}">
      <meta itemprop="dateModified" content="{{ page_data.meta.last_published_at }}">
      <div class="tna-background-accent-light tna-!--padding-top-l tna-!--padding-bottom-l">
        <div class="tna-container">
          <div class="tna-column tna-column--width-2-3 tna-column--width-5-6-medium tna-column--full-small tna-column--full-tiny">
            <hgroup class="tna-hgroup-xl">
              <p class="tna-hgroup__supertitle">Blog post</p>
              <h1 class="tna-hgroup__title" itemprop="name">{{ page_data.title }}</h1>
            </hgroup>
            {%- if page_data.intro %}
            <div class="tna-large-paragraph tna-!--margin-top-s" itemprop="headline">
              {{ page_data.intro | tna_html | safe }}
            </div>
            {%- endif %}
            <p>
              <small>Published {{ page_data.published_date.value | pretty_date_with_day }}
                {%- if page_data.authors | length %}
                by
                {% for author in page_data.authors -%}
                  {{ ' and ' if loop.index > 1 and loop.last else ', ' if loop.index > 1 else '' }}<a href="{{ author.url }}">{{ author.title }}</a>
                {%- endfor -%}
                {%- endif %}
              </small>
            </p>
          </div>
        </div>
      </div>


      {%- if page_data.hero_image %}
      <div class="etna-background-accent-light-half">
        <div class="tna-container">
          <div class="tna-column tna-column--full">
            {% set hero_image_caption = page_data.hero_image_caption or '' %}
            {%- if page_data.hero_image.copyright %}
              {% set hero_image_caption = hero_image_caption + '<p>&copy; ' + page_data.hero_image.copyright + '</p>' %}
            {%- endif %}
            {{ tnaHero({
              'imageSrc': page_data.hero_image.jpeg.full_url,
              'imageAlt': page_data.hero_image.alt_text or '',
              'imageWidth': page_data.hero_image.jpeg.width,
              'imageHeight': page_data.hero_image.jpeg.height,
              'imageCaption': hero_image_caption,
              'imageSources': [
                {
                  'src': page_data.hero_image_small.webp.full_url,
                  'width': page_data.hero_image_small.webp.width,
                  'height': page_data.hero_image_small.webp.height,
                  'type': 'image/webp',
                  'media': '(max-width: 48em)'
                },
                {
                  'src': page_data.hero_image_small.jpeg.full_url,
                  'width': page_data.hero_image_small.jpeg.width,
                  'height': page_data.hero_image_small.jpeg.height,
                  'type': 'image/jpeg',
                  'media': '(max-width: 48em)'
                },
                {
                  'src': page_data.hero_image.webp.full_url,
                  'width': page_data.hero_image.webp.width,
                  'height': page_data.hero_image.webp.height,
                  'type': 'image/webp'
                }
              ]
            }) }}
          </div>
        </div>
      </div>
      {%- endif %}


      <div class="tna-section">
        <div class="tna-container tna-container--centred">
          <div class="tna-column tna-column--width-2-3 tna-column--width-5-6-medium tna-column--full-small tna-column--full-tiny etna-!--full-width-on-print" itemprop="articleBody">
            {{ wagtail_body(page_data.body, 2) }}
          </div>
        </div>
      </div>
      {%- if page_data.authors | length %}
      <div class="tna-section">
        <div class="tna-container tna-container--centred">
          {{ authors_list(page_data.authors, False, 'tna-column--width-2-3 tna-column--width-5-6-medium tna-column--full-small tna-column--full-tiny etna-!--full-width-on-print') }}
        </div>
      </div>
      {%- endif %}
      <!-- {%- if blogs %}
      <div class="tna-section">
        <div class="tna-container tna-container--centred">
          <div class="tna-column tna-column--width-2-3 tna-column--width-5-6-medium tna-column--full-small tna-column--full-tiny etna-!--full-width-on-print tna-!--margin-top-l">
            <h2 class="tna-heading-l">Other blogs at The National Archives</h2>
            {%- for blog in blogs %}
              {{ wagtailFeaturedPage({'page': blog}, 3, loop.first) }}
            {%- endfor %}
          </div>
        </div>
      </div>
      {%- endif %} -->
    </article>
  </div>
</main>
{% endblock %}

{% block bodyEnd %}
{{ super() }}
    {%- if bodyContainsMedia %}
    <script src="{{ url_for('static', filename='media.min.js', v=app_config.BUILD_VERSION) }}" defer></script>
    {%- endif %}
{% endblock %}
